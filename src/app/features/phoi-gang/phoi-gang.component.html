<div class="page-header">
  <div class="header-content">
    <div class="title-section">
      <div class="title-line">
        <mat-icon class="title-icon">inventory</mat-icon>
        <h1 class="main-title">{{ maGang() }}</h1>
        <span class="gang-id">(ID: {{ id() }})</span>
      </div>
    </div>
    
    <div class="header-actions">
      <button mat-stroked-button (click)="onAddPlan()" class="action-btn add-btn">
        <mat-icon>add</mat-icon>
        Thêm phương án
      </button>
      <button mat-stroked-button (click)="onCompare()" class="action-btn compare-btn">
        <mat-icon>compare</mat-icon>
        So sánh
      </button>
      <button mat-stroked-button (click)="onSummary()" class="action-btn summary-btn">
        <mat-icon>summarize</mat-icon>
        Tổng hợp
      </button>
    </div>
  </div>
</div>

<div *ngIf="plans().length === 0" class="empty-state">
  <div class="empty-card">
    <div class="empty-icon">
      <mat-icon>inventory_2</mat-icon>
    </div>
    <h3 class="empty-title">Chưa có phương án phối</h3>
    <p class="empty-description">Chưa thiết lập phương án phối cho quặng gang này.</p>
    <button mat-flat-button color="primary" (click)="onAddPlan()" class="empty-action">
      <mat-icon>add</mat-icon>
      Tạo phương án đầu tiên
    </button>
  </div>
</div>

<mat-tab-group *ngIf="plans().length > 0" [selectedIndex]="selectedIndex()">
  <mat-tab *ngFor="let p of plans(); let i = index">
    <ng-template mat-tab-label>
      <div class="tab-label-container">
        <span class="tab-label">{{ p.ten }}</span>
      <button mat-icon-button [matMenuTriggerFor]="planMenu" (menuOpened)="setMenuContext(p.id, i)" [matMenuTriggerData]="{ id: p.id, index: i }" class="tab-close" matTooltip="Tuỳ chọn">
          <mat-icon>more_vert</mat-icon>
        </button>
      </div>
    </ng-template>

    <ng-template matTabContent>
      <app-phoi-gang-plan-tab
        [plan]="p"
        [gangId]="id()"
        [maGang]="maGang()"
        (requestRename)="onRenamePlan(i)"
        (requestRemove)="onRemovePlan(i)"></app-phoi-gang-plan-tab>
    </ng-template>
  </mat-tab>
</mat-tab-group>

<mat-menu #planMenu="matMenu" class="icon-only-menu">
  <ng-template matMenuContent let-data="matMenuTriggerData">
  <button mat-menu-item class="menu-item rename" matTooltip="Đổi tên" (click)="onRenamePlanById(data?.id, data?.index)">
    <mat-icon>edit</mat-icon>
  </button>
  <button mat-menu-item class="menu-item clone" matTooltip="Nhân bản" (click)="onClonePlan(data?.id, data?.index)">
    <mat-icon>content_copy</mat-icon>
  </button>
  <!-- <button mat-menu-item class="menu-item delete" matTooltip="Xoá phương án" (click)="onRemovePlanById(data?.id, data?.index, $event)">
    <mat-icon>delete</mat-icon>
  </button> -->
  <button mat-menu-item class="menu-item delete-permanent" matTooltip="Xoá vĩnh viễn" (click)="onDeletePlanById(data?.id, data?.index, $event)">
    <mat-icon>delete_forever</mat-icon>
  </button>
  </ng-template>
</mat-menu>
