<div class="page-header">
  <div class="header-content">
    <button mat-icon-button (click)="onBack()" matTooltip="Quay lại">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h3 class="title">So sánh phương án phối: {{ maGang() }} <span class="muted">(ID: {{ id() }})</span></h3>
  </div>
  <!-- Milestone selector removed; both sections displayed below -->
</div>

<div class="content">
  <div *ngIf="loading()" class="loading-state">
    <mat-icon>hourglass_empty</mat-icon>
    <div>Đang tải dữ liệu...</div>
  </div>

  <div *ngIf="!loading() && plans().length === 0" class="empty-state">
    <div class="empty-box">
      <mat-icon>info</mat-icon>
      <div>Chưa có phương án phối để so sánh.</div>
    </div>
  </div>

  <div *ngIf="!loading() && plans().length > 0" class="compare-content">
    <!-- Plan Summary Cards removed -->

    <!-- One long comparison matrix (Thiêu Kết + Lò Cao) -->
    <mat-card class="comparison-matrix-card">
      <mat-card-header>
        <mat-card-title>Ma trận so sánh tỷ lệ (Thiêu Kết + Lò Cao)</mat-card-title>
        <mat-card-subtitle>Tỷ lệ phối (%) và một số chỉ tiêu theo từng phương án</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="table-container">
          <table class="comparison-matrix">
            <thead>
              <tr>
                <th class="ore-column">Hạng mục</th>
                <th class="unit-column">Đơn vị</th>
                <th *ngFor="let plan of plans()" class="plan-column">{{ plan.ten_Phuong_An }}</th>
              </tr>
            </thead>
            <tbody>
              <!-- Section: Thiêu Kết -->
              <tr class="section-header">
                <td class="ore-cell" [attr.colspan]="2 + plans().length">1. THIÊU KẾT</td>
              </tr>
              <tr *ngFor="let row of getComparisonDataThieuKet()" class="ore-row">
                <td class="ore-cell">{{ row.ore }}</td>
                <td class="unit-cell">{{ getUnitFor(row.ore) }}</td>
                <td *ngFor="let plan of plans()" class="ratio-cell" 
                    [class.has-value]="getOreRatio(row, plan.ten_Phuong_An) > 0">
                  {{ formatRatio(getOreRatio(row, plan.ten_Phuong_An)) }}
                </td>
              </tr>

              <!-- Section: Lò Cao -->
              <tr class="section-header">
                <td class="ore-cell" [attr.colspan]="2 + plans().length">2. LÒ CAO</td>
              </tr>
              <tr *ngFor="let row of getComparisonDataLoCao()" class="ore-row">
                <td class="ore-cell">{{ row.ore }}</td>
                <td class="unit-cell">{{ getUnitFor(row.ore) }}</td>
                <td *ngFor="let plan of plans()" class="ratio-cell" 
                    [class.has-value]="getOreRatio(row, plan.ten_Phuong_An) > 0">
                  {{ formatRatio(getOreRatio(row, plan.ten_Phuong_An)) }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Cost Comparison (Placeholder) -->
    <mat-card class="cost-comparison-card">
      <mat-card-header>
        <mat-card-title>So sánh chi phí</mat-card-title>
        <mat-card-subtitle>Chi phí sản xuất theo từng phương án</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="cost-summary">
          <div class="cost-item" *ngFor="let plan of plans()">
            <div class="cost-plan-name">{{ plan.ten_Phuong_An }}</div>
            <div class="cost-value">{{ getMockCost(plan.ten_Phuong_An) | number:'1.0-0' }} VND/tấn</div>
          </div>
        </div>
        <div class="cost-note">
          <mat-icon>info</mat-icon>
          <span>Chi phí sẽ được tính toán dựa trên giá quặng và tỷ lệ phối</span>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Recommendations -->
    <mat-card class="recommendations-card">
      <mat-card-header>
        <mat-card-title>Khuyến nghị</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="recommendations">
          <div class="recommendation-item">
            <mat-icon class="recommendation-icon">star</mat-icon>
            <div class="recommendation-text">
              <strong>Phương án tối ưu:</strong> Cần tính toán chi phí để đánh giá
            </div>
          </div>
          <div class="recommendation-item">
            <mat-icon class="recommendation-icon">info</mat-icon>
            <div class="recommendation-text">
              <strong>Ghi chú:</strong> Ma trận hiển thị tỷ lệ phối của {{ getComparisonDataThieuKet().length }} loại quặng qua {{ plans().length }} phương án
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
