<div class="page-header">
  <div class="header-content">
    <button mat-icon-button (click)="onBack()" matTooltip="Quay lại">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <h3 class="title">So sánh phương án phối: {{ maGang() }} <span class="muted">(ID: {{ id() }})</span></h3>
  </div>
  <div class="header-actions">
    <div class="calculation-parameters">
      <div class="parameter-row">
        <mat-form-field appearance="outline" class="parameter-field">
          <mat-label>Tỷ lệ TFe (%)</mat-label>
          <input matInput type="number" [formControl]="tyleTFE" placeholder="0">
        </mat-form-field>
        
        <mat-form-field appearance="outline" class="parameter-field">
          <mat-label>Tỷ lệ Tổng</mat-label>
          <input matInput type="number" [formControl]="tyleTong" placeholder="0">
        </mat-form-field>
        <mat-form-field appearance="outline" class="parameter-field">
          <mat-label>Tiêu hao tăng TFe (%)</mat-label>
          <input matInput type="number" [formControl]="tieuhaoTangTFE" placeholder="0">
        </mat-form-field>
        
        <mat-form-field appearance="outline" class="parameter-field">
          <mat-label>Tiêu hao tăng Tổng</mat-label>
          <input matInput type="number" [formControl]="tieuhaoTangTong" placeholder="0">
        </mat-form-field>

        <mat-form-field appearance="outline" class="parameter-field">
          <mat-label>Sản lượng giảm TFe (%)</mat-label>
          <input matInput type="number" [formControl]="sanluongGiamTFE" placeholder="0">
        </mat-form-field>
        
        <mat-form-field appearance="outline" class="parameter-field">
          <mat-label>Sản lượng giảm Tổng (%)</mat-label>
          <input matInput type="number" [formControl]="sanluongGiamTong" placeholder="0">
        </mat-form-field>
      </div>
    </div>
  </div>
</div>

<div class="content">
  <div *ngIf="loading()" class="loading-state">
    <mat-icon>hourglass_empty</mat-icon>
    <div>Đang tải dữ liệu...</div>
  </div>

  <div *ngIf="!loading() && plans().length === 0" class="empty-state">
    <div class="empty-box">
      <mat-icon>info</mat-icon>
      <div>Chưa có phương án phối để so sánh.</div>
    </div>
  </div>

  <div *ngIf="!loading() && plans().length > 0" class="excel-table-container">
    <div class="excel-table-wrapper">
      <table class="excel-table">
        <thead>
          <tr>
            <th class="excel-header-cell">PA</th>
            <th class="excel-header-cell">Đơn vị</th>
            <th *ngFor="let plan of getPlanColumns()" class="excel-header-cell">{{ plan }}</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of getExcelData()" 
              [class.section-header-row]="row.isSectionHeader"
              [class.bold-row]="row.isBold"
              [class.yellow-row]="row.isYellow"
              [style.background-color]="row.backgroundColor">
            <td class="excel-cell name-cell" 
                [class.section-header-cell]="row.isSectionHeader"
                [class.bold-text]="row.isBold">
              {{ row.name }}
            </td>
            <td class="excel-cell unit-cell">{{ row.unit || '' }}</td>
            <td *ngFor="let plan of getPlanColumns()" 
                class="excel-cell value-cell"
                [class.bold-text]="row.isBold"
                [class.has-value]="formatValue(row.values[plan], row.unit) !== ''">
              {{ formatValue(row.values[plan], row.unit) }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>